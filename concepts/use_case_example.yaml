actions:
 create_vm:
    transport: my_amqp

 attach_volumes:
    transport: my_amqp

 format_volumes:
    transport: my_amqp

transports:
  my_amqp:
     type: amqp
     host: my_host
     port: 5672
     exchange: amqp_direct
     routing-key: my_queue
     user: guest
     password: guest
     content-type: application/json

tasks:
 create_vm:
    action: create_vm
    args:
      - (my_image_id, my_flavor_id)

 attach_volumes:
    requires: [create_vm]
    action: attach_volume
    args:
      - (ctx.vm_id, 10GB, /mnt/my_vol1)
      - (ctx.vm_id, 7GB, /mnt/my_vol2)
      - (ctx.vm_id, 15GB, /mnt/my_vol3)

 format_volumes:
    requires: [attach_volumes]
    action: format_volume
    args:
      - (ctx.vm_id, /mnt/my_vol1)
      - (ctx.vm_id, /mnt/my_vol2)
      - (ctx.vm_id, /mnt/my_vol3)
